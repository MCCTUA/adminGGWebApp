<script>
  function loadContactTable(updateDataTable = false) {
    async function loadContactDataTable() {
      try {
        showSwal()
        const tableExtraOptions = {
          tableId: 'contact-table',
          // hideColumns: [13, 14, 15, 16]
          targetIndexShowImage: [3, 15],
        }
        const { data } = await googelScriptrun('getContactData')
        const { data: compantyData } = await googelScriptrun('getCompanyData')
        const { data: touchPoint } = await googelScriptrun('getTochPointList')

        const dataModify = data.slice(1).map((row) =>
          row.map((el, index) => {
            if (index === 12 && el !== '') {
              const companyList = []
              const indexCompanyArray = compantyData.findIndex(
                (item) => item[0] === el
              )
              companyList.push(compantyData[indexCompanyArray][4])
              row[index] = companyList.join(', ')
            } else if (index === 13 && el !== '') {
              const touchPointList = []
              const touchPointArray = el.split(', ')
              touchPointArray.map((touchPointId) =>
                touchPoint.map((point, index) => {
                  if (point[0] === touchPointId) {
                    touchPointList.push(touchPoint[index][1])
                  }
                })
              )
              row[index] = touchPointList.join(', ')
            } else {
              return el
            }
          })
        )

        const { contact } = await googelScriptrun(
          'getHeaderTableName',
          'contact'
        )

        const columnLenght = data.shift().length - 4
        const res = {}

        if (columnLenght + 2 === contact.headerTableName.length) {
          res.data = data.map((row) => row.slice(0, columnLenght))
          res.headersAll = contact.headerTableName
        } else {
          console.log('header length not equal to data in column length')
        }

        if (!updateDataTable) {
          const table = loadDataTable(res, tableExtraOptions)
        } else {
          let table = $(`#${tableExtraOptions.tableId}`).DataTable()
          table.clear().rows.add(data).draw()
        }
      } catch (error) {
        catchError(error)
      } finally {
        hideSwal('พร้อมใช้งาน')
      }
    }
    loadContactDataTable()
  }
</script>
